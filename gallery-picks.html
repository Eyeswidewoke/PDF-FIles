<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GALLERY PICKS | THE PDF FILES</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg:#0f1218; --surface:#171c24; --surface-2:#1f2631; --border:#2d3643;
      --text:#e8edf4; --muted:#92a0b4; --accent:#1a8fc4; --accent-2:#4db8e8; --warm:#d35d2c;
      --sans:'Space Grotesk',system-ui,sans-serif; --mono:'IBM Plex Mono',monospace;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--sans); color:var(--text);
      background:radial-gradient(circle at 12% 0%,#141c24 0%,#0f1218 55%);
    }
    a{color:var(--accent)}
    .back-link{
      display:inline-block;margin:1rem;padding:.5rem 1rem;border:1px solid var(--border);border-radius:.5rem;
      color:var(--muted);font:600 .78rem var(--mono);text-decoration:none;
    }
    .back-link:hover{color:var(--accent);border-color:var(--accent)}
    .hero{
      border-bottom:2px solid var(--warm);
      background:linear-gradient(170deg,#1a0e0a 0%,#150d08 45%,#0f1218 100%);
      padding:2rem 1rem 1.2rem; text-align:center;
    }
    .hero h1{
      margin:0; font-size:clamp(1.5rem,4vw,2.4rem);
      background:linear-gradient(90deg,var(--warm),#f0a060);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      letter-spacing:.03em;
    }
    .hero p{margin:.6rem auto 0;max-width:76ch;color:var(--muted);font-size:.9rem}
    .hero .count{
      display:inline-block;margin-top:.6rem;padding:.25rem .7rem;border-radius:999px;
      background:rgba(211,93,44,.15);border:1px solid rgba(211,93,44,.4);
      font:700 .85rem var(--mono);color:#f0a060;
    }
    .hero-nav{
      max-width:980px;margin:.9rem auto 0;display:grid;gap:.5rem;
      grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    }
    .hero-btn{
      display:inline-flex;align-items:center;justify-content:center;
      min-height:2.4rem;padding:.35rem .55rem;border-radius:.5rem;
      border:1px solid rgba(255,255,255,.2);font:600 .72rem var(--mono);letter-spacing:.02em;
      color:#fff;text-decoration:none;
    }
    .hero-btn:hover{filter:saturate(1.08) brightness(1.04);text-decoration:none}
    .wrap{max-width:1400px;margin:0 auto;padding:1rem}
    .cat-gallery-panel{
      padding:1rem;
    }
    .cat-gallery-head h2{
      margin:0;
      font:700 1rem var(--mono);
      letter-spacing:.03em;
      color:#dbe9f5;
    }
    .cat-gallery-head p{
      margin:.4rem 0 .8rem;
      color:var(--muted);
      font-size:.78rem;
    }
    .cat-gallery-grid{
      display:grid;
      gap:.6rem;
      grid-template-columns:repeat(auto-fit,minmax(190px,1fr));
    }
    .cat-thumb-card{
      display:grid;
      grid-template-rows:auto 1fr;
      border:1px solid var(--border);
      border-radius:.75rem;
      overflow:hidden;
      background:var(--surface-2);
      color:inherit;
      text-decoration:none;
      transition:border-color .15s, transform .15s;
    }
    .cat-thumb-card:hover{
      border-color:var(--accent);
      transform:translateY(-1px);
      text-decoration:none;
    }
    .cat-thumb-card.active{
      border-color:var(--warm);
      box-shadow:0 0 0 1px rgba(211,93,44,.3) inset;
    }
    .cat-thumb-media{
      aspect-ratio:16/10;
      background:#0d1117;
      overflow:hidden;
    }
    .cat-thumb-media img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .cat-thumb-body{
      padding:.5rem .55rem .55rem;
      display:grid;
      gap:.2rem;
    }
    .cat-thumb-name{
      margin:0;
      font:700 .7rem var(--mono);
      color:#f2f7ff;
      text-transform:uppercase;
      letter-spacing:.03em;
      line-height:1.2;
    }
    .cat-thumb-meta{
      font:600 .64rem var(--mono);
      color:var(--muted);
    }
    .cat-thumb-action{
      margin-top:.1rem;
      font:700 .62rem var(--mono);
      color:#9ed9ee;
      letter-spacing:.02em;
    }
    .panel{
      background:var(--surface);border:1px solid var(--border);border-radius:.85rem;padding:.9rem;margin-bottom:1rem;
    }
    .controls{
      display:flex;flex-wrap:wrap;gap:.5rem;align-items:center;
    }
    .controls input, .controls select{
      border:1px solid var(--border);border-radius:.55rem;
      background:var(--surface-2);color:var(--text);padding:.52rem .58rem;
      font:500 .78rem var(--mono);
    }
    .controls input{flex:1 1 240px;min-width:200px}
    .controls select{flex:0 0 auto;min-width:140px}
    .meta{
      margin:.55rem 0 0;color:var(--muted);font:500 .74rem var(--mono);
    }
    /* Category pills */
    .cat-bar{
      display:flex;flex-wrap:wrap;gap:.35rem;margin:.7rem 0 .3rem;
    }
    .cat-pill{
      cursor:pointer;border:1px solid var(--border);border-radius:999px;
      padding:.22rem .55rem;font:600 .68rem var(--mono);color:var(--muted);
      background:var(--surface-2);transition:all .15s;user-select:none;
      text-decoration:none;display:inline-block;
    }
    .cat-pill:hover{border-color:var(--accent);color:var(--accent)}
    .cat-pill.active{
      border-color:var(--warm);color:#fff;background:rgba(211,93,44,.25);
    }
    .cat-pill .cnt{opacity:.6;margin-left:.2rem}
    /* Image grid â€” masonry-ish */
    .grid{
      display:grid;gap:.6rem;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
    }
    .card{
      background:var(--surface);border:1px solid var(--border);border-radius:.65rem;overflow:hidden;
      transition:border-color .15s;
    }
    .card:hover{border-color:var(--accent)}
    .thumb-wrap{
      background:#0d1117;aspect-ratio:4/3;display:grid;place-items:center;overflow:hidden;
      cursor:pointer;
    }
    .thumb{
      max-width:100%;max-height:100%;display:block;object-fit:contain;
    }
    .body{padding:.5rem .55rem}
    .body .cat-label{
      display:inline-block;font:700 .62rem var(--mono);padding:.08rem .3rem;border-radius:.3rem;
      background:rgba(211,93,44,.12);border:1px solid rgba(211,93,44,.35);color:#f0a060;
      margin-bottom:.25rem;text-transform:uppercase;letter-spacing:.04em;
    }
    .body .efta{
      margin:0;font:500 .72rem var(--mono);color:var(--muted);word-break:break-all;
    }
    .body .tags{
      margin:.25rem 0 0;display:flex;flex-wrap:wrap;gap:.2rem;
    }
    .body .tag{
      font:500 .6rem var(--mono);padding:.05rem .25rem;border-radius:.25rem;
      border:1px solid var(--border);color:var(--muted);
    }
    /* Lightbox */
    .lightbox{
      position:fixed;inset:0;z-index:1000;background:rgba(0,0,0,.92);
      display:none;place-items:center;cursor:zoom-out;
    }
    .lightbox.open{display:grid}
    .lightbox img{
      max-width:95vw;max-height:92vh;object-fit:contain;border-radius:.5rem;
      box-shadow:0 0 60px rgba(0,0,0,.6);
    }
    .lightbox .lb-info{
      position:absolute;bottom:1rem;left:50%;transform:translateX(-50%);
      background:rgba(0,0,0,.7);padding:.4rem .8rem;border-radius:.5rem;
      font:600 .72rem var(--mono);color:var(--muted);text-align:center;
      max-width:90vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .lightbox .lb-nav{
      position:absolute;top:50%;font-size:2.5rem;color:#fff;cursor:pointer;
      user-select:none;padding:.5rem;opacity:.5;transition:opacity .15s;
    }
    .lightbox .lb-nav:hover{opacity:1}
    .lightbox .lb-prev{left:1rem;transform:translateY(-50%)}
    .lightbox .lb-next{right:1rem;transform:translateY(-50%)}
    .empty{
      color:var(--muted);font:500 .8rem var(--mono);text-align:center;padding:2rem .6rem;
      border:1px dashed var(--border);border-radius:.7rem;background:var(--surface);
      grid-column:1/-1;
    }
    @media (max-width:620px){
      .grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr))}
    }
  </style>
</head>
<body>
  <script src="./nav.js"></script>
  <a class="back-link" href="./images.html">&larr; BACK TO IMAGES PAGE</a>

  <header class="hero">
    <h1>â­ GALLERY PICKS</h1>
    <p>
      Hand-picked images from the Epstein Files classified photo collection.
      682 images across 19 categories â€” buildings, planes, boats, people, documents, and more.
    </p>
    <span class="count" id="heroCount">Loading...</span>
    <nav class="hero-nav" aria-label="Gallery navigation">
      <a class="hero-btn" href="./index.html" style="background:linear-gradient(125deg,#5e4732,#3f2d1f)">HOME &rarr;</a>
      <a class="hero-btn" href="./images.html" style="background:linear-gradient(125deg,#1a8fc4,#156f98)">IMAGES PAGE &rarr;</a>
      <a class="hero-btn" href="./handwritten-notes.html" style="background:linear-gradient(125deg,#4a6741,#344a2e)">HANDWRITTEN NOTES &rarr;</a>
      <a class="hero-btn" href="./search.html" style="background:linear-gradient(125deg,#7d4d00,#5d3900)">SEARCH &rarr;</a>
      <a class="hero-btn" href="./cast.html" style="background:linear-gradient(125deg,#d35d2c,#9d3916)">CAST HUB &rarr;</a>
    </nav>
  </header>

  <main class="wrap">
    <section class="panel cat-gallery-panel">
      <div class="cat-gallery-head">
        <h2>CATEGORY GALLERIES</h2>
        <p>
          Jump directly to the major gallery categories. Each tile uses a representative thumbnail and opens that category view.
        </p>
      </div>
      <div id="categoryDeck" class="cat-gallery-grid"></div>
    </section>

    <section class="panel">
      <div class="controls">
        <input id="q" type="search" placeholder="Search by EFTA, filename, tag..." autocomplete="off" spellcheck="false" />
        <select id="sortBy">
          <option value="rank">Sort: Default</option>
          <option value="category">Sort: Category</option>
          <option value="efta">Sort: EFTA #</option>
        </select>
      </div>
      <div class="cat-bar" id="catBar"></div>
      <p class="meta" id="meta">Loading gallery...</p>
    </section>

    <section id="grid" class="grid"></section>
  </main>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox">
    <span class="lb-nav lb-prev" id="lbPrev">&lsaquo;</span>
    <span class="lb-nav lb-next" id="lbNext">&rsaquo;</span>
    <img id="lbImg" src="" alt="" />
    <div class="lb-info" id="lbInfo"></div>
  </div>

  <script>
    (function(){
      const state = { items:[], filtered:[], activeCat:null, lbIdx:-1, handwritten:null, categoryPageByCat:{} };

      const el = {
        q: document.getElementById("q"),
        sortBy: document.getElementById("sortBy"),
        meta: document.getElementById("meta"),
        grid: document.getElementById("grid"),
        catBar: document.getElementById("catBar"),
        categoryDeck: document.getElementById("categoryDeck"),
        heroCount: document.getElementById("heroCount"),
        lightbox: document.getElementById("lightbox"),
        lbImg: document.getElementById("lbImg"),
        lbInfo: document.getElementById("lbInfo"),
        lbPrev: document.getElementById("lbPrev"),
        lbNext: document.getElementById("lbNext"),
      };

      function esc(s){ return String(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"); }
      function href(p){ return "./" + String(p||"").replace(/^\.?\//,"").split("/").map(s=>encodeURIComponent(decodeURIComponent(s))).join("/"); }
      function slugifyCategory(value){
        return String(value||"")
          .trim()
          .toLowerCase()
          .replace(/&/g, " and ")
          .replace(/[^a-z0-9]+/g, "-")
          .replace(/^-+|-+$/g, "") || "uncategorized";
      }

      function catHref(cat){
        const mapped = state.categoryPageByCat[String(cat||"")];
        if(mapped) return `./${mapped}`;
        return `./gallery-category-${slugifyCategory(cat)}.html`;
      }
      function normCat(value){ return String(value||"").trim().toLowerCase(); }

      function resolveCategoryName(raw){
        const wanted = normCat(raw);
        if(!wanted) return null;
        const hit = state.items.find(it => normCat(it.category || "unknown") === wanted);
        return hit ? (hit.category || "unknown") : null;
      }

      function buildCategoryDeck(){
        if(!el.categoryDeck) return;
        const counts = {};
        const sampleByCat = {};
        state.items.forEach((it) => {
          const cat = it.category || "unknown";
          counts[cat] = (counts[cat] || 0) + 1;
          if(!sampleByCat[cat] || Number(it.rank || 999999) < Number(sampleByCat[cat].rank || 999999)){
            sampleByCat[cat] = it;
          }
        });
        const topCats = Object.entries(counts).sort((a,b) => b[1]-a[1]).slice(0, 10);
        const cards = [];

        if(state.handwritten && state.handwritten.thumb){
          cards.push(
            `<a class="cat-thumb-card" href="./handwritten-notes.html">` +
              `<div class="cat-thumb-media"><img loading="lazy" src="${href(state.handwritten.thumb)}" alt="Handwritten Notes Gallery" /></div>` +
              `<div class="cat-thumb-body">` +
                `<p class="cat-thumb-name">HANDWRITTEN NOTES</p>` +
                `<span class="cat-thumb-meta">${Number(state.handwritten.count || 0).toLocaleString()} images</span>` +
                `<span class="cat-thumb-action">Open Handwritten Gallery &rarr;</span>` +
              `</div>` +
            `</a>`
          );
        }

        topCats.forEach(([cat, count]) => {
          const sample = sampleByCat[cat];
          if(!sample || !sample.image_path) return;
          cards.push(
            `<a class="cat-thumb-card${cat === state.activeCat ? " active" : ""}" data-cat-card="${esc(cat)}" href="${catHref(cat)}">` +
              `<div class="cat-thumb-media"><img loading="lazy" src="${href(sample.image_path)}" alt="${esc(cat)} category thumbnail" /></div>` +
              `<div class="cat-thumb-body">` +
                `<p class="cat-thumb-name">${esc(cat)}</p>` +
                `<span class="cat-thumb-meta">${count.toLocaleString()} images</span>` +
                `<span class="cat-thumb-action">Open Category Gallery &rarr;</span>` +
              `</div>` +
            `</a>`
          );
        });

        el.categoryDeck.innerHTML = cards.join("");
      }

      function buildCatBar(){
        const counts = {};
        state.items.forEach(it => { const c=it.category||'unknown'; counts[c]=(counts[c]||0)+1; });
        const sorted = Object.entries(counts).sort((a,b)=>b[1]-a[1]);
        const allActive = !state.activeCat;
        let html = `<a class="cat-pill${allActive ? " active" : ""}" data-cat="__all__" href="./gallery-picks.html">All <span class="cnt">${state.items.length}</span></a>`;
        sorted.forEach(([cat,cnt]) => {
          html += `<a class="cat-pill${cat === state.activeCat ? " active" : ""}" data-cat="${esc(cat)}" href="${catHref(cat)}">${esc(cat)} <span class="cnt">${cnt}</span></a>`;
        });
        el.catBar.innerHTML = html;
      }

      function applyFilters(){
        const q = String(el.q.value||"").trim().toLowerCase();
        const sortBy = el.sortBy.value;

        let rows = state.items.filter(it => {
          if(state.activeCat && (it.category||'unknown') !== state.activeCat) return false;
          if(q){
            const hay = [it.id, it.efta, it.source_pdf, (it.tags||[]).join(" "), it.category].join(" ").toLowerCase();
            if(!hay.includes(q)) return false;
          }
          return true;
        });

        rows.sort((a,b) => {
          if(sortBy==="category") return String(a.category||"").localeCompare(b.category||"") || a.rank-b.rank;
          if(sortBy==="efta") return String(a.efta||"").localeCompare(b.efta||"",undefined,{numeric:true});
          return a.rank - b.rank;
        });

        state.filtered = rows;
        render();
      }

      function card(item, idx){
        const tags = (item.tags||[]).slice(0,5).map(t=>`<span class="tag">${esc(t)}</span>`).join("");
        return (
          `<article class="card">` +
            `<div class="thumb-wrap" data-idx="${idx}">` +
              `<img class="thumb" loading="lazy" src="${href(item.image_path)}" alt="${esc(item.id)}" />` +
            `</div>` +
            `<div class="body">` +
              `<span class="cat-label">${esc(item.category||'unknown')}</span>` +
              `<p class="efta">${esc(item.efta || item.id)}</p>` +
              `<div class="tags">${tags}</div>` +
            `</div>` +
          `</article>`
        );
      }

      function render(){
        el.meta.textContent = `Showing ${state.filtered.length.toLocaleString()} of ${state.items.length.toLocaleString()} images.`;
        if(!state.filtered.length){
          el.grid.innerHTML = `<div class="empty">No images match current filters.</div>`;
          return;
        }
        el.grid.innerHTML = state.filtered.map(card).join("");
        // Attach lightbox listeners
        el.grid.querySelectorAll('.thumb-wrap').forEach(wrap => {
          wrap.addEventListener('click', () => openLightbox(parseInt(wrap.dataset.idx)));
        });
      }

      function openLightbox(idx){
        if(idx<0||idx>=state.filtered.length) return;
        state.lbIdx = idx;
        const item = state.filtered[idx];
        el.lbImg.src = href(item.image_path);
        el.lbInfo.textContent = `${item.category} â€” ${item.efta||item.id} (${idx+1}/${state.filtered.length})`;
        el.lightbox.classList.add('open');
      }

      function closeLightbox(){
        el.lightbox.classList.remove('open');
        state.lbIdx = -1;
      }

      el.lightbox.addEventListener('click', e => { if(e.target===el.lightbox||e.target===el.lbImg) closeLightbox(); });
      el.lbPrev.addEventListener('click', e => { e.stopPropagation(); openLightbox(state.lbIdx-1); });
      el.lbNext.addEventListener('click', e => { e.stopPropagation(); openLightbox(state.lbIdx+1); });
      document.addEventListener('keydown', e => {
        if(!el.lightbox.classList.contains('open')) return;
        if(e.key==='Escape') closeLightbox();
        if(e.key==='ArrowLeft') openLightbox(state.lbIdx-1);
        if(e.key==='ArrowRight') openLightbox(state.lbIdx+1);
      });

      async function boot(){
        try{
          const notesPromise = fetch("./content/images/galleries/handwritten-notes/index.json", {cache:"no-store"})
            .then(r => r.ok ? r.json() : null)
            .catch(() => null);
          const categoryPagesPromise = fetch("./content/images/galleries/gallery-picks-2026-02-16/category-pages.json", {cache:"no-store"})
            .then(r => r.ok ? r.json() : null)
            .catch(() => null);

          const resp = await fetch("./content/images/galleries/gallery-picks-2026-02-16/index.json", {cache:"no-store"});
          if(!resp.ok) throw new Error("HTTP "+resp.status);
          const data = await resp.json();
          state.items = Array.isArray(data.items)?data.items:[];

          const notesData = await notesPromise;
          const categoryPagesData = await categoryPagesPromise;
          if(notesData && Array.isArray(notesData.items) && notesData.items.length){
            state.handwritten = {
              count: notesData.items.length,
              thumb: notesData.items[0].image_path
            };
          }
          if(categoryPagesData && Array.isArray(categoryPagesData.pages)){
            categoryPagesData.pages.forEach((row) => {
              const category = row && row.category;
              const file = row && row.file;
              if(category && file) state.categoryPageByCat[String(category)] = String(file);
            });
          }

          state.activeCat = resolveCategoryName(new URLSearchParams(window.location.search).get("cat"));
          el.heroCount.textContent = `${state.items.length} images`;
          buildCategoryDeck();
          buildCatBar();
          el.q.addEventListener("input", applyFilters);
          el.sortBy.addEventListener("change", applyFilters);
          applyFilters();
        }catch(err){
          el.meta.textContent = "Gallery failed to load.";
          el.grid.innerHTML = `<div class="empty">${esc(err&&err.message?err.message:String(err))}</div>`;
        }
      }

      boot();
    })();
  </script>
</body>
</html>


