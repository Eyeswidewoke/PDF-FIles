<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FULL-TEXT SEARCH | THE PDF FILES</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="./styles.css?v=20260218-ftx1" />
  <style>
    .ftx-hero { text-align: center; }
    .ftx-hero h1 { margin-bottom: 0.3rem; }
    .ftx-search-box {
      max-width: 680px;
      margin: 1.2rem auto 0;
      display: flex;
      gap: 0.5rem;
    }
    .ftx-search-box input {
      flex: 1;
      font-size: 1.05rem;
      padding: 0.65rem 0.9rem;
      border: 2px solid var(--border);
      border-radius: 0.6rem;
      font-family: var(--mono);
      background: #fffdf7;
      transition: border-color 0.15s;
    }
    .ftx-search-box input:focus {
      outline: none;
      border-color: #8f2f15;
    }
    .ftx-search-box button {
      padding: 0.65rem 1.3rem;
      border: none;
      border-radius: 0.6rem;
      background: linear-gradient(125deg, #8f2f15, #6b2310);
      color: #fff;
      font: 600 0.95rem var(--mono);
      cursor: pointer;
      white-space: nowrap;
    }
    .ftx-search-box button:hover { opacity: 0.9; }

    .ftx-filters {
      max-width: 680px;
      margin: 0.7rem auto 0;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    .ftx-filters select {
      font: 500 0.78rem var(--mono);
      padding: 0.3rem 0.5rem;
      border: 1px solid var(--border);
      border-radius: 0.4rem;
      background: #fffdf7;
    }

    .ftx-status {
      text-align: center;
      margin-top: 0.8rem;
      color: var(--muted);
      font: 500 0.82rem var(--mono);
      min-height: 1.4rem;
    }

    .ftx-results {
      max-width: 900px;
      margin: 1rem auto 0;
      display: grid;
      gap: 0.6rem;
    }

    .ftx-result {
      border: 1px solid var(--border);
      border-radius: 0.7rem;
      background: #fffcf8;
      padding: 0.65rem 0.8rem;
      box-shadow: 0 4px 14px rgba(53,36,27,0.07);
    }
    .ftx-result-head {
      display: flex;
      justify-content: space-between;
      align-items: start;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .ftx-result-efta {
      font: 700 0.95rem var(--mono);
      color: #8f2f15;
      text-decoration: none;
    }
    .ftx-result-efta:hover { text-decoration: underline; }
    .ftx-result-chips {
      display: flex;
      gap: 0.3rem;
      flex-wrap: wrap;
    }
    .ftx-chip {
      border: 1px solid #dfb7a8;
      color: #8f2f15;
      border-radius: 999px;
      padding: 0.06rem 0.4rem;
      font: 600 0.65rem var(--mono);
      white-space: nowrap;
      background: #fff6ef;
    }
    .ftx-chip.chip-ds {
      border-color: #7f6757;
      background: #f3ece4;
      color: #3e3127;
    }
    .ftx-chip.chip-folder {
      border-color: #5d7a3c;
      background: #eef7df;
      color: #2f4a1a;
    }
    .ftx-result-meta {
      margin-top: 0.3rem;
      color: var(--muted);
      font: 500 0.72rem var(--mono);
    }
    .ftx-result-actions {
      margin-top: 0.35rem;
      display: flex;
      gap: 0.4rem;
      flex-wrap: wrap;
    }
    .ftx-result-actions a {
      font: 600 0.7rem var(--mono);
      padding: 0.2rem 0.5rem;
      border-radius: 0.35rem;
      text-decoration: none;
      border: 1px solid #dfb7a8;
      color: #8f2f15;
      background: #fff6ef;
    }
    .ftx-result-actions a:hover {
      background: #ffe8d8;
    }
    .ftx-copy-btn {
      font: 600 0.7rem var(--mono);
      padding: 0.2rem 0.5rem;
      border-radius: 0.35rem;
      border: 1px solid #b0b0b0;
      color: #444;
      background: #f4f4f4;
      cursor: pointer;
    }
    .ftx-copy-btn:hover {
      background: #e0e0e0;
    }

    .ftx-load-more {
      text-align: center;
      margin: 1rem 0 2rem;
    }
    .ftx-load-more button {
      padding: 0.5rem 1.5rem;
      border: 2px solid var(--border);
      border-radius: 0.5rem;
      background: #fffdf7;
      font: 600 0.82rem var(--mono);
      cursor: pointer;
    }
    .ftx-load-more button:hover { background: #f5efe8; }

    .ftx-info {
      max-width: 680px;
      margin: 1.5rem auto 0;
      padding: 0.8rem 1rem;
      background: #f5efe8;
      border: 1px solid var(--border);
      border-radius: 0.6rem;
      font-size: 0.82rem;
      color: #5f4e46;
      line-height: 1.5;
    }
    .ftx-info strong { color: #3e3127; }

    @media (max-width: 700px) {
      .ftx-search-box { flex-direction: column; }
      .ftx-result-head { flex-direction: column; }
      /* on mobile, panel covers full screen instead of side-by-side */
      body.panel-open .ftx-results,
      body.panel-open .ftx-hero,
      body.panel-open .ftx-status,
      body.panel-open .ftx-load-more,
      body.panel-open .ftx-info {
        margin-right: 0;
      }
      .ftx-panel { width: 100vw; }
    }

    /* === SIDE PANEL for document viewer === */
    .ftx-panel-overlay {
      display: none;
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.18);
      z-index: 900;
      pointer-events: auto;
    }
    .ftx-panel-overlay.open { display: block; }

    .ftx-panel {
      display: none;
      position: fixed; top: 0; right: 0; bottom: 0;
      width: min(700px, 90vw);
      background: #fffdf7;
      border-left: 3px solid #d4af37;
      box-shadow: -8px 0 30px rgba(0,0,0,0.25);
      z-index: 950;
      overflow-y: auto;
      transform: translateX(100%);
      transition: transform 0.25s ease;
    }
    .ftx-panel.open {
      display: block;
      transform: translateX(0);
    }

    /* shrink main content when panel is open */
    body.panel-open .ftx-results,
    body.panel-open .ftx-hero,
    body.panel-open .ftx-status,
    body.panel-open .ftx-load-more,
    body.panel-open .ftx-info {
      margin-right: min(710px, 91vw);
      transition: margin-right 0.25s ease;
    }

    /* highlight the currently-viewed result */
    .ftx-result.viewing {
      border-color: #d4af37;
      box-shadow: 0 0 0 2px #d4af3755, 0 4px 14px rgba(53,36,27,0.12);
    }
    .ftx-result.viewing .ftx-view-btn {
      background: #d4af37 !important;
      color: #fff !important;
      border-color: #d4af37 !important;
    }

    .ftx-panel-bar {
      position: sticky; top: 0; z-index: 10;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0.6rem 1rem;
      background: #3e3127; color: #fffdf7;
      font: 700 0.85rem var(--mono);
    }
    .ftx-panel-bar a { color: #d4af37; text-decoration: none; font-size: 0.75rem; }
    .ftx-panel-bar a:hover { text-decoration: underline; }
    .ftx-panel-close {
      background: none; border: none; color: #fffdf7; font-size: 1.5rem;
      cursor: pointer; padding: 0 0.3rem; line-height: 1;
    }
    .ftx-panel-close:hover { color: #d4af37; }
    .ftx-panel-body { padding: 1rem; }
    .ftx-panel-body .page-card {
      background: #f5efe8; border: 1px solid #e0d5c8; border-radius: 0.5rem;
      padding: 0.8rem; margin-bottom: 0.75rem;
    }
    .ftx-panel-body .page-card-head {
      font: 600 0.7rem var(--mono); color: #8a7a6a;
      margin-bottom: 0.4rem; display: flex; justify-content: space-between;
      flex-wrap: wrap; gap: 0.3rem;
    }
    .ftx-panel-body .page-text {
      font: 400 0.82rem/1.6 var(--mono); color: #3e3127;
      white-space: pre-wrap; word-break: break-word;
      background: #fffdf7; border-radius: 0.35rem; padding: 0.7rem;
      max-height: 500px; overflow-y: auto; border: 1px solid #e0d5c8;
    }
    .ftx-panel-loading { text-align: center; color: #8a7a6a; padding: 2rem 0; }
    .ftx-panel-error { text-align: center; color: #c44; padding: 1.5rem 0; }
  </style>
</head>
<body>
  <div class="noise"></div>
  <script src="./nav.js"></script>

  <header class="hero ftx-hero">
    <h1>FULL-TEXT SEARCH</h1>
    <p class="subhead" style="margin:0.4rem auto 0;max-width:68ch">
      Search across <strong id="ftxDocCount">...</strong> OCR-extracted text documents.
      Every word from every page of every released file &mdash; searchable in your browser.
    </p>
    <div class="hero-divider" aria-hidden="true"></div>

    <div class="ftx-search-box">
      <input id="ftxInput" type="search" placeholder="Search names, addresses, phone numbers, anything..." autocomplete="off" spellcheck="false" autofocus />
      <button id="ftxSearchBtn" type="button">SEARCH</button>
    </div>

    <div class="ftx-filters">
      <select id="ftxFolderFilter" aria-label="Filter by category">
        <option value="all">All Categories</option>
        <option value="Legal-Filings">Legal Filings</option>
        <option value="Emails">Emails</option>
        <option value="Depositions">Depositions</option>
        <option value="Communications">Communications</option>
        <option value="Financial">Financial</option>
        <option value="Support">Support Docs</option>
        <option value="Contacts">Contacts</option>
        <option value="Unsorted">Unsorted</option>
      </select>
      <select id="ftxDatasetFilter" aria-label="Filter by dataset">
        <option value="all">All Datasets</option>
        <option value="DataSet1">DS 1</option>
        <option value="DataSet2">DS 2</option>
        <option value="DataSet3">DS 3</option>
        <option value="DataSet4">DS 4</option>
        <option value="DataSet5">DS 5</option>
        <option value="DataSet6">DS 6</option>
        <option value="DataSet7">DS 7</option>
        <option value="DataSet8">DS 8</option>
        <option value="DataSet9">DS 9</option>
        <option value="DataSet10">DS 10</option>
        <option value="DataSet11">DS 11</option>
        <option value="DataSet12">DS 12</option>
      </select>
      <select id="ftxSortField" aria-label="Sort by">
        <option value="relevance">Sort: Relevance</option>
        <option value="words-desc">Sort: Most Text</option>
        <option value="words-asc">Sort: Least Text</option>
        <option value="efta-asc">Sort: EFTA Asc</option>
        <option value="efta-desc">Sort: EFTA Desc</option>
      </select>
    </div>
  </header>

  <p id="ftxStatus" class="ftx-status"></p>

  <div id="ftxResults" class="ftx-results"></div>

  <div id="ftxLoadMore" class="ftx-load-more" hidden>
    <button id="ftxLoadMoreBtn" type="button">Load More Results</button>
  </div>

  <div class="ftx-info" id="ftxInfo">
    <strong>How it works:</strong> This search uses a sharded inverted index built from OCR-extracted text of all released Epstein files.
    When you search, only the relevant index shards are downloaded &mdash; not the entire index.
    Each result links to the DOJ FOIA release page for that file number.
    <br><br>
    <strong>Tips:</strong> Use specific names, addresses, or phrases. Multi-word queries find documents containing ALL terms.
    Try: <em>andrew farkas</em>, <em>flight manifest</em>, <em>palm beach</em>, <em>deutsche bank</em>.
  </div>

  <script src="./ftx-search-app.js?v=20260218-ftx1" defer></script>

  <!-- Side panel for viewing extracted text -->
  <div class="ftx-panel-overlay" id="ftxPanelOverlay" onclick="closeFtxPanel()"></div>
  <div class="ftx-panel" id="ftxPanel">
    <div class="ftx-panel-bar">
      <span id="ftxPanelTitle">Document</span>
      <span>
        <a id="ftxPanelFullLink" href="#" target="_blank">Open Full Page â†—</a>
        &nbsp;
        <button class="ftx-panel-close" onclick="closeFtxPanel()" title="Close">&times;</button>
      </span>
    </div>
    <div class="ftx-panel-body" id="ftxPanelBody">
      <div class="ftx-panel-loading">Select a document to view...</div>
    </div>
  </div>

  <script>
  var TXT_CDN = "https://eyeswidewoke.github.io/PDF-Files-text/data/txt/";

  function openFtxPanel(efta, triggerEl) {
    var panel = document.getElementById("ftxPanel");
    var overlay = document.getElementById("ftxPanelOverlay");
    var body = document.getElementById("ftxPanelBody");
    var title = document.getElementById("ftxPanelTitle");
    var fullLink = document.getElementById("ftxPanelFullLink");

    // highlight active result
    var prev = document.querySelector(".ftx-result.viewing");
    if (prev) prev.classList.remove("viewing");
    if (triggerEl) {
      var card = triggerEl.closest(".ftx-result");
      if (card) card.classList.add("viewing");
    }

    title.textContent = efta;
    fullLink.href = "./view.html?id=" + encodeURIComponent(efta);
    body.innerHTML = '<div class="ftx-panel-loading">Loading ' + efta + '...</div>';

    overlay.classList.add("open");
    panel.classList.add("open");
    document.body.classList.add("panel-open");
    // trigger reflow for animation
    void panel.offsetWidth;

    var digits = efta.replace(/^EFTA/, "");
    var prefix = digits.substring(0, 4);

    fetch(TXT_CDN + prefix + ".json")
      .then(function(r) { if (!r.ok) throw new Error("HTTP " + r.status); return r.json(); })
      .then(function(shard) {
        var pages = shard[efta];
        if (!pages || !pages.length) {
          body.innerHTML = '<div class="ftx-panel-error">No extracted text found for ' + efta + '.</div>';
          return;
        }
        var html = '';
        for (var i = 0; i < pages.length; i++) {
          var p = pages[i];
          var text = (p.x || "(no text)").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
          var trunc = p.tr ? ' <span style="color:#8f2f15">[truncated]</span>' : '';
          html +=
            '<div class="page-card">' +
              '<div class="page-card-head">' +
                '<span>Page ' + (i+1) + '/' + pages.length + '</span>' +
                '<span>' + (p.f||'') + '</span>' +
                '<span>' + (p.w||0) + ' words' + trunc + '</span>' +
              '</div>' +
              '<div class="page-text">' + text + '</div>' +
            '</div>';
        }
        body.innerHTML = html;
      })
      .catch(function(err) {
        body.innerHTML = '<div class="ftx-panel-error">Error loading text: ' + err.message + '</div>';
      });
  }

  function closeFtxPanel() {
    document.getElementById("ftxPanel").classList.remove("open");
    document.getElementById("ftxPanelOverlay").classList.remove("open");
    document.body.classList.remove("panel-open");
    var prev = document.querySelector(".ftx-result.viewing");
    if (prev) prev.classList.remove("viewing");
  }

  // Close on Escape key
  document.addEventListener("keydown", function(e) {
    if (e.key === "Escape") closeFtxPanel();
  });
  </script>
</body>
</html>